Explicaci√≥n super detallada de streamlit_app.py
=============================================

1) IMPORTS Y DEPENDENCIAS
-------------------------
- streamlit as st:
  Framework principal para construir la interfaz web. Provee widgets, layouts
  y gesti√≥n de estado.
- joblib:
  Carga el modelo entrenado de clasificaci√≥n (archivo .pkl).
- pandas as pd:
  Manipulaci√≥n de datos tabulares (DataFrames) para resultados y features.
- plotly.express / plotly.graph_objects:
  Librer√≠as para gr√°ficos interactivos (pie, histograma, scatter, box, barras).
- SentenceTransformer:
  Modelo de embeddings para convertir texto en vectores num√©ricos.
- EmailProcessor:
  Clase propia que extrae caracter√≠sticas t√©cnicas del email raw.
- styles (COLORS, apply_custom_styles):
  Define paleta de colores y aplica CSS personalizado.
- components (metric_card, result_card_html, hero_banner, sidebar_info):
  Componentes UI reutilizables (tarjetas, banner, panel lateral).

2) CONFIGURACI√ìN DE LA APP
--------------------------
st.set_page_config(...) define:
- title: "SpamSense AI"
- icono: üìß
- layout: wide (ancho)

apply_custom_styles() inyecta estilos personalizados para la UI.

3) CARGA DE MODELOS (CACHEADA)
------------------------------
@st.cache_resource evita recargar modelos en cada interacci√≥n.
load_assets():
- spam_model = joblib.load("model/spam_model.pkl")
- emb_model = SentenceTransformer("all-mpnet-base-v2", cache_folder="./model_cache")
Retorna ambos modelos.

Luego:
spam_model, emb_model = load_assets()
processor = EmailProcessor(emb_model)

EmailProcessor usa el modelo de embeddings para generar features desde el email.

4) FUNCI√ìN render_dashboard(batch_df, features_df)
--------------------------------------------------
Objetivo: construir un panel forense con KPIs, gr√°ficos y tablas.
Par√°metros:
- batch_df: resultados (label, confidence, subject_length, name)
- features_df: features t√©cnicos extra√≠dos por EmailProcessor

4.1 Validaci√≥n inicial:
Si batch_df o features_df est√°n vac√≠os:
- st.info("No data available...") y termina la funci√≥n.

4.2 KPIs:
- total: n√∫mero total de emails
- spam: cantidad con label "SPAM"
- ham: total - spam
- avg_conf: promedio de confidence
- spam_rate: porcentaje de spam

Se muestran en 5 tarjetas (metric_card) con √≠conos y colores.

4.3 Visualizaciones principales:
Columna izquierda:
- Pie/Donut chart con distribuci√≥n SPAM/HAM.
- Colores definidos en COLORS.
Columna derecha:
- Histograma doble (SPAM vs HAM) de la confianza.

4.4 Tabla detallada:
- Copia batch_df a display_df
- confidence se convierte a porcentaje string.
- Renombra columnas:
  name -> Email File
  label -> Classification
  confidence -> Confidence
  subject_length -> Subject Length
- Se muestra con st.dataframe, con ayudas (help).

4.5 An√°lisis avanzado:
- Scatter plot: subject_length vs confidence, coloreado por label.
- Box plot: distribuci√≥n de confidence por clase (SPAM/HAM).

4.6 An√°lisis de features t√©cnicos:
Tres columnas con barras horizontales/verticales:

A) Header Anomalies:
- Return-Path Mismatch
- Reply-To Differs
- Missing Message-ID
- Random Message-ID
Se muestra la tasa promedio.

B) Routing Indicators:
- Avg Received Headers
- Private IP Rate
Promedios en barras.

C) Content Structure:
- % HTML Content
- % Multipart Content
Promedios en barras.

5) UI PRINCIPAL
---------------
Sidebar:
with st.sidebar: sidebar_info()

Banner superior:
hero_banner()

Tabs:
tab1 = "Single Email Analysis"
tab2 = "Batch Analysis"

6) TAB 1: SINGLE EMAIL ANALYSIS
-------------------------------
- Texto de ayuda: pegar email completo RFC 822.
- st.text_area para contenido raw.
- Bot√≥n ‚ÄúAnalyze Email‚Äù.

Flujo al presionar el bot√≥n:
1. Si raw est√° vac√≠o -> warning.
2. Si hay contenido:
   - processor.transform_raw_email(raw) -> DataFrame de features.
   - pred = spam_model.predict(df)[0]
   - prob = spam_model.predict_proba(df)[0][pred]
   - label = "SPAM" si pred=1, si no "HAM".
   - color seg√∫n label.
   - Renderiza card de resultado con result_card_html.
   - Expander con detalles t√©cnicos (df.T).

Errores se capturan con try/except -> st.error.

7) TAB 2: BATCH ANALYSIS
------------------------
- Subida m√∫ltiple de archivos .eml o .txt.
- Bot√≥n ‚ÄúGenerate Report‚Äù (deshabilitado si no hay archivos).

Al ejecutar:
- Inicializa results y all_features.
- Barra de progreso y texto de estado.
- Por cada archivo:
  - Lee bytes -> decode utf-8 (con replace).
  - Normaliza saltos de l√≠nea.
  - Extrae features con processor.
  - Predice label y confidence.
  - Guarda: name, label, confidence, subject_length.
  - Guarda features en all_features.
- Limpia barra y estado.
- Si hay resultados:
  - st.success
  - render_dashboard(pd.DataFrame(results), pd.concat(all_features))
- Si no hay resultados:
  - st.error

8) FLUJO GENERAL DE DATOS
-------------------------
1. Usuario ingresa email(s).
2. EmailProcessor extrae features t√©cnicos.
3. Modelo spam_model clasifica y calcula confianza.
4. Se muestran resultados inmediatos o dashboard completo.

9) GLOSARIO DE INGL√âS Y TECNICISMOS
-----------------------------------
Palabras en ingl√©s:
- Framework: conjunto de herramientas/librer√≠as para construir aplicaciones.
- Layout: distribuci√≥n visual de los elementos en pantalla.
- Model / Models: modelo matem√°tico entrenado para predecir.
- Cache / Cacheada: memoria temporal para reutilizar resultados y acelerar.
- Resource: recurso (modelo, conexi√≥n, objeto pesado).
- Dashboard: panel de control con m√©tricas y gr√°ficos.
- KPI (Key Performance Indicator): indicador clave de rendimiento.
- Spam / Ham: correo no deseado / correo leg√≠timo.
- Avg (Average): promedio.
- Confidence: nivel de confianza de la predicci√≥n.
- Batch: lote (procesamiento de varios archivos a la vez).
- Upload / Uploader: subir archivos.
- Raw: contenido original sin procesar.
- Parse / Parsing: analizar y extraer partes del texto.
- Feature(s): caracter√≠stica(s) num√©rica(s) usada(s) por el modelo.
- Header: cabecera del email (From, To, Subject, etc.).
- Reply-To: cabecera con direcci√≥n de respuesta.
- Message-ID: identificador √∫nico del email.
- Return-Path: direcci√≥n real usada para devoluciones.
- Routing: ruta que sigui√≥ el email por servidores.
- Received: cabecera que registra saltos del email.
- HTML: formato de email con etiquetas (texto enriquecido).
- Multipart: email con varias partes (texto + HTML + adjuntos).
- Plot: gr√°fico.
- Scatter plot: gr√°fico de dispersi√≥n (puntos).
- Box plot: gr√°fico de caja (medianas y dispersi√≥n).
- Histogram: histograma (distribuci√≥n de frecuencias).
- Pie chart: gr√°fico de pastel.
- Donut chart: gr√°fico de pastel con agujero.
- Label: etiqueta de clase (SPAM/HAM).
- Predict: predecir.
- Probability / Proba: probabilidad.
- Tab: pesta√±a.
- Sidebar: panel lateral.
- Hero banner: cabecera visual destacada.
- Card: tarjeta informativa visual.
- Progress bar: barra de progreso.

Tecnicismos profesionales:
- RFC 822: est√°ndar que define el formato de los emails (headers + body).
- Embeddings: vectores num√©ricos que representan texto en un espacio matem√°tico.
- DataFrame: tabla de datos en memoria (filas y columnas).
- Classifier: modelo que asigna una clase (SPAM/HAM).
- Predict_proba: m√©todo que devuelve probabilidad por clase.
- Vectorizar: convertir texto en n√∫meros para el modelo.
- Feature extraction: proceso de extraer variables √∫tiles del texto.
- UX/UI: experiencia de usuario / interfaz de usuario.
- Decode (utf-8): convertir bytes a texto usando una codificaci√≥n.
